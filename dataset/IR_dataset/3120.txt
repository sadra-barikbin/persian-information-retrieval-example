در قرن چهارم هجری اکثر مناطق ایران زمین به دین اسلام درآمده‌بودند؛ ولی در طبرستان و گیلان وضع متفاوت بود. مردم این نواحی هنوز به دیانت زرتشتی وفادار بودند. چون تا آن زمان حاکمان مسلمان نتوانسته بودند بر این مناطق چیره شوند، نوعی آزادی دینی و سیاسی در منطقه حاکم بود. بخشی از مردم تحت تأثیر علویان زیدی، که از دست خلفا به منطقه می‌گریختند، به مذهب تشیع گرویدند و تا قرون چهارم و پنجم هجری هنوز نیمی از مردم زرتشتی بودند و نیمی دیگر شیعه شده‌بودند.

در اواسط قرن سوم هجری خلافت عباسی با جنبش‌های استقلال‌طلبانه‌ای مواجه شد که ضعف سیاسی او را در پی داشت. این جنبش‌ها در میان ایرانیان، که از پیش منتظر فرصتی برای شورش بودند، با ظهور دولت‌های سامانیان، صفاریان و زیاریان، به اوج رسید. همچنین اوایل قرن چهارم هجری در شمال ایران جنبش‌های گوناگونی علیه خلیفه آغاز شد که اسفار بن شیرویه، ماکان کاکی، مرداویج و آل بویه از این دسته‌اند. این جنبش‌ها در نتیجه‌ی ضعف دستگاه خلافت روی داد و از شورش ساجیان در آذربایجان آغاز شد و در میان مردمی که عناصر ایرانی داشتند، همچون کردها، دیلمیان و گیل‌ها ادامه یافت. البته مقام خلیفه در سرزمین‌های سُنی‌مذهب هنوز قداست و احترام گذشتهٔ خود را حفظ کرده‌بود و دولت‌ها مجبور به پذیرش خلافت بودند تا مقام خود را مشروعیت بخشند.

بزرگترین دشمنان خلیفه در این زمان علویان شیعه بودند که ادعای خلافت می‌کردند. در طبرستان و دیلم زیدیان طرفداران بسیاری یافتند ولی پس از دو یا سه نسل علویان طبرستان و گیلان از شعارهای عدالت‌طلبانهٔ نخستین خود عدول کرده و به کنار رانده شدند. این اوضاع زمینه را برای قیام اشرافی که نسب خود را به ساسانیان می‌رساندند، فراهم نمود و در این منطقه نیاز به حکومتی بود که دو قشر شیعیان و زرتشتیان را اقناع کند. در این دوره میان فرزندان ناصر کبیر و داعی صغیر اختلاف روی داده بود و اردوگاه علویان دو دستگی وجود داشت.

اسفار بن شیرویه، یک فرد نظامی بود که نخست در خدمت ماکان بن کاکی بود و پس از او به حکومت ری رسید. بنابه رای ابواسحاق صابی پس از آن که حسن بن قاسم (معروف به داعی صغیر) هروسندان بن تیرداد، شاه گیلانیان (که دایی مرداویج بود) را به همراه شش تن دیگر از بزرگان گیل و دیلم به قتل رسانید، بزرگان دیلم بر داعی شوریدند و اسفار بن شیرویه را به ریاست خویش برگزیدند و به اطاعت فرمان‌روای خراسان درآمدند و از او برای غلبه بر داعی صغیر یاری خواستند. با کشته شدن سران دیلم کار داعی آشفته شد و از گرگان به طبرستان رفت، سپس به ماکان بن کاکی پیوست. اسفار پس از کسب قدرت همانند دیگر رهبران دیلمی از علویان روی گردانید و علیه داعی صغیر و ماکان بن کاکی به نبرد پرداخت.