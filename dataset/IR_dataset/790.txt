در شیراز کریم‌خان زند با آقامحمدخان به نیکی رفتار کرد. هرچند منابع قاجاری می‌گویند که او در آنجا چون یک مهمان بوده اما به نظر می‌رسد که این رفتار وکیل از روی حس تحقر نسبت به آقامحمدخان بوده‌است. آقامحمدخان ۲۰ سال در دربار زندیه به اسارت ماند و در طول این زمان، کریم‌خان با او در مسائل مختلف مشورت می‌کرد. گفتگوهای میان این دو در ربط با موضوعات گوناگون چون تاریخ ایران و حکومت‌داری و نقل حکایت‌ها و افسانه‌هاست. کریم‌خان زند آقامحمدخان را «پیران ویسه» که در "شاهنامه" وزیر افراسیاب و از پشتیبانان سیاوش است، می‌خواند. او معمولاً در شیراز وقتش را به شکار سپری می‌کرد. در یکی از این حکایت‌ها، به نقل از "رستم‌التواریخ"، وکیل از او در مورد رابطهٔ ایران و انگلیسی‌ها می‌پرسد و آقامحمدخان هم پاسخ می‌دهد: «ایران مانند استری چموش است و فرنگی حکیمی کاردان. بر استر چموش نمی‌توان سوار شد؛ مگر به زیرکی و تدبیر.» در حکایتی دیگر، از فتحعلی‌شاه نقل است که آقامحمدخان نفرت خود از وکیل را با ریز ریز کردن قالی‌های قصر او به وسیلهٔ خنجر، بروز می‌داد. کریم‌خان نیز در جواب گفت: «به روی او نیاورند که دل‌شکسته و پدر کشته‌است.»

با وجود رفتار مهربانانهٔ وکیل، آقامحمدخان قاجار به هر روی اسیر او بود و وی را قاتل پدر خود می‌دانست اما این اسارت به محمدخان کمک کرد که رقبای خود را از نزدیک بشناسد و اختلافات میان آنان را ببیند. به علاوه، حضور خدیجه‌بیگم در حرمسرای کریم‌خان باعث می‌شد که او از اسرار دربار بی‌خبر نماند؛ همو بود که پس از مرگ وکیل آقامحمدخان را از اسارت فراری داد.

در ۱۷۶۹ م، کریم‌خان زند، حسین‌قلی‌خان جهانسوز برادر آقامحمدخان را به حاکمیت قومس گماشت تا ضمن مقابله با نفوذ دولوها، حکومت سلسلهٔ زند بر آن ناحیه را حفظ کند اما زمان نشان داد که این تصمیم اشتباهی بود؛ زیرا او در پی انتقام از شاخه رقیب ایل قاجار برآمد. رقابت میان دو شاخه به اندازه‌ای بالا گرفت که کریم‌خان مجبور شد مداخله کند. در آخر، حسین قلی‌خان در ۱۷۷۷ م. توسط یموت‌ها در شرق استرآباد کشته شد. در این زمان او از همسر خود آسیه خانم عزت‌الدینلو دو فرزند داشت: فتحعلی و حسین‌قلی. از آنجا که آقامحمدخان فرزندی نداشت، با مرگ برادرش حسین‌قلی‌خان جهانسوز، فرزند خردسالش فتحعلی به وارث محمدخان به عنوان رئیس ایل قوانلو تبدیل شد.

به هر روی، کریم‌خان در مارس ۱۷۷۹ م/۱۱۹۳ ه‍.ق درگذشت. آقامحمدخان چند روز پیش از مرگ او، از طریق خدیجه‌بیگم از بیماری او آگاه شده بود و به بهانهٔ شکار شیراز را ترک کرده بود. چون مرگ وکیل فرا رسید، خان قاجار که در این زمان ۳۷ سال داشت، گریخت و رو به سوی مازندران نهاد. خروج او از شیراز به معنای ادعای دوبارهٔ قاجاریان بر تاج و تخت ایران بود؛ موضوعی که آقامحمدخان آن را نه یک رؤیای جدید که جامهٔ عمل پوشاندن به آرزوهای پدر خود می‌دید.